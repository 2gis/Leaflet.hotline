function makeGradienter(){function t(t,i){i=i||{},this._data=t||[],this._grouped=[],this._gradientPercent=i.gradientPercent||30,this._minGradient=i.minGradient||10,this._minColorLength=i.minColorLength||20,this._maxGradient=i.maxGradient||30,this._needRecalc=!0}var i={findPointOnLine:function(t,i,n){if(0===n)return t;var e=t.x,o=t.y,r=i.x,s=i.y,h=[r-e,s-o],a=Math.sqrt(h[0]*h[0]+h[1]*h[1]),l=[h[0]/a,h[1]/a];return{x:e+n*l[0],y:o+n*l[1]}},distanceTo:function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}};return t.prototype._groupedByColor=function(){var t,i,n,e,o=[];for(t=0,i=this._data.length;i>t;t++)n=this._data[t],n.z===e?o.push(n):(o.length&&(1===o.length&&o.push(o[0]),this._grouped.push({points:o,color:o[0].z})),o=[n]),e=n.z;return o.length&&this._grouped.push({points:o,color:o[0].z}),this},t.prototype._setGroupsDistance=function(){var t,n,e,o,r,s,h,a=0;for(t=0,e=this._grouped.length;e>t;t++){for(o=this._grouped[t],a=0,n=0,r=o.points.length;r>n;n++)h=o.points[n],s=o.points[n+1],s&&(a+=i.distanceTo(h,s));o.distance=a,o.toDelete=this._minColorLength>o.distance}return this},t.prototype._cleanGrouped=function(){var t,i,n,e=[];for(t=0,i=this._grouped.length;i>t;t++)n=this._grouped[t],n&&n.points&&n.points.length&&e.push(this._grouped[t]);return this._grouped=e,this},t.prototype._setGradientsLength=function(){var t,i,n,e,o;for(t=0,n=this._grouped.length;n>t;t++)o=this._grouped[t-1],i=this._grouped[t],e=this._grouped[t+1],i.startGradient=0,o&&(i.startGradient=Math.floor(Math.min(o.distance,i.distance)*this._gradientPercent/100),i.startGradient=Math.max(Math.min(i.startGradient,this._maxGradient),this._minGradient)),i.endGradient=0,e&&(i.endGradient=Math.floor(Math.min(e.distance,i.distance)*this._gradientPercent/100),i.endGradient=Math.max(Math.min(i.endGradient,this._maxGradient),this._minGradient));return this},t.prototype.changePointsColor=function(t,i){var n,e;for(n=0,e=i.length;e>n;n++)i[n].z=t;return i},t.prototype._calculateGradientPoints=function(){var t,n,e,o,r,s,h,a,l=0;for(t=0,r=this._grouped.length;r>t;t++){if(s=this._grouped[t],s.startGradient){l=0;var d=0;for(n=0,h=s.points.length;h>n;n++){if(e=s.points[n],a=s.points[n+1],a&&(l+=i.distanceTo(e,a)),l>s.startGradient){o=i.findPointOnLine(e,a,s.startGradient-d),o.z=a.z,s.points=s.points.slice(0,n+1).concat([o]).concat(s.points.slice(n+1));break}d=l}}if(s.endGradient){l=0;var u;for(h=s.points.length-1,n=h;n>=0;n--)if(e=s.points[n],u=s.points[n-1],u&&(l+=i.distanceTo(e,u)),l>s.endGradient){o=i.findPointOnLine(u,e,l-s.endGradient),o.z=e.z,s.points=s.points.slice(0,n).concat([o]).concat(s.points.slice(n));break}}s.startGradient&&s.points[0]&&(s.points[0].z=void 0),s.endGradient&&s.points[s.points.length-1]&&(s.points[s.points.length-1].z=void 0)}return this},t.prototype._getPathByGrouped=function(){var t,i,n=[];for(t=0,i=this._grouped.length;i>t;t++){var e=this._grouped[t].points;t!==i-1&&e.pop(),n=n.concat(e)}return n},t.prototype._calculateGradientLength=function(){for(;this._needRecalc;)this._needRecalc=!1,this._setGroupsDistance()._deleteShortGroups();return this._setGradientsLength(),this},t.prototype._deleteShortGroups=function(){var t,i,n,e,o;for(t=0,n=this._grouped.length;n>t;t++)o=this._grouped[t-1],i=this._grouped[t],e=this._grouped[t+1],i.toDelete&&(o||e)&&(o&&(!e||o.distance>e.distance)?(i.points=this.changePointsColor(o.color,i.points),o.points=o.points.concat(i.points)):e&&(i.points=this.changePointsColor(e.color,i.points),e.points=i.points.concat(e.points)),delete this._grouped[t],this._needRecalc=!0);return this._cleanGrouped()},t.prototype.getGradientPath=function(){return this._groupedByColor()._calculateGradientLength()._calculateGradientPoints()._getPathByGrouped()},t}"undefined"!=typeof window?window.L.Util.Gradienter=makeGradienter():module.exports=makeGradienter(),/*
 (c) 2015, iosphere GmbH
 Leaflet.hotline, a Leaflet plugin for drawing gradients along polylines.
 https://github.com/iosphere/Leaflet.hotline/
 */
function(t,i){"function"==typeof define&&define.amd?define(["leaflet"],i):"object"==typeof exports?module.exports=i:i(t.L)}(this,function(t){if(t.Hotline)return t;t.HotlineUtil=t.extend(t.LineUtil,{clipSegment:function(i,n,e,o,r){var s,h,a,l=o?this._lastCode:t.LineUtil._getBitCode(i,e),d=t.LineUtil._getBitCode(n,e);for(this._lastCode=d;;){if(!(l|d))return[i,n];if(l&d)return!1;s=l||d,h=this._getEdgeIntersection(i,n,s,e,r),a=this._getBitCode(h,e),s===l?(h.z=i.z,i=h,l=a):(h.z=n.z,n=h,d=a)}},_simplifyDP:function(t,i){var n=t.length,e=typeof Uint8Array!=void 0+""?Uint8Array:Array,o=new e(n);o[0]=o[n-1]=1;for(var r=0,s=t.length;s>r;r++)t[r].cantBeDeleted&&(o[r]=1);this._simplifyDPStep(t,o,i,0,n-1);var h,a=[];for(h=0;n>h;h++)o[h]&&a.push(t[h]);return a},_reducePoints:function(i,n){for(var e=[i[0]],o=1,r=0,s=i.length;s>o;o++)(t.LineUtil._sqDist(i[o],i[r])>n||i[o].cantBeDeleted)&&(e.push(i[o]),r=o);return s-1>r&&e.push(i[s-1]),e}});var i=function(t,n){if(!(this instanceof i))return new i(t);var e={0:"green",.5:"yellow",1:"red"};this._map=n,this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._weight=5,this._min=0,this._max=1,this._data=[],this._dataOrigin=[],this.palette(e)};i.prototype={width:function(t){return this._width=t,this},height:function(t){return this._height=t,this},weight:function(t){return this._weight=t,this},zoomWeight:function(t){return this._zoomWeight=t,this},outlines:function(t){return this._outlines=t,this},palette:function(t){return this._palette=this.calcPalette(t),this},calcPalette:function(t){var i=document.createElement("canvas"),n=i.getContext("2d"),e=n.createLinearGradient(0,0,0,256);i.width=1,i.height=256;for(var o in t)e.addColorStop(o,t[o]);return n.fillStyle=e,n.fillRect(0,0,1,256),n.getImageData(0,0,1,256).data},unknownColor:function(t){var i=this.calcPalette([t]);return this._unknownColor=[i[0],i[1],i[2]],this},maxGradient:function(t){return this._maxGradient=t,this},minGradient:function(t){return this._minGradient=t,this},minColorLength:function(t){return this._minColorLength=t,this},gradientPercent:function(t){return this._gradientPercent=t,this},color:function(t){var i=this.calcPalette([t]);this._color=[i[0],i[1],i[2]]},min:function(t){return this._min=t,this},max:function(t){return this._max=t,this},data:function(i){this._dataOrigin=i;var n,e,o,r,s,h=[];for(n=0,o=i.length;o>n;n++){for(r=i[n],h[n]=[],e=0,s=r.length;s>e;e++)h[n][e]=t.point(r[e].x,r[e].y),h[n][e].z=r[e].z;h[n]=this.setGradientPoint(h[n])}return this._data=this.setRGBData(h),this},setGradientPoint:function(i){var n=new t.Util.Gradienter(i,{maxGradient:this._maxGradient,minGradient:this._minGradient,minColorLength:this._minColorLength,gradientPercent:this._gradientPercent});return n.getGradientPath()},setRGBData:function(t){var i,n,e,o,r,s,h,a;for(i=0,e=t.length;e>i;i++){for(o=t[i],n=0,r=o.length;r>n;n++)h=o[n],"undefined"!=typeof h.z&&(h.rgb=this.getRBGForPoint(h));for(n=0,r=o.length;r>n;n++)s=o[n-1],h=o[n],a=o[n+1],h.rgb||(s&&a&&s.rgb&&a.rgb?h.rgb=[Math.floor((s.rgb[0]+a.rgb[0])/2),Math.floor((s.rgb[1]+a.rgb[1])/2),Math.floor((s.rgb[2]+a.rgb[2])/2)]:h.rgb=this.getRBGForPoint(h))}return t},getRBGForPoint:function(t){var i=t.rgb;return i||(i="undefined"==typeof t.z?this._color||this._unknownColor:-1===t.z?this._unknownColor:this.getRGBForValue(t.z)),i},add:function(t){return this.data(this._dataOrigin.push(t)),this},clear:function(t){return t&&(this._data=[]),this._ctx.clearRect(0,0,this._width,this._height),this},draw:function(t){var i=this._ctx;return i.globalCompositeOperation=t?"destination-out":"source-over",i.lineCap="round",i.lineJoin="round",this._drawOutlines(i,t),t?this:(this._drawHotline(i),i.fill(),this)},getRGBForValue:function(t){var i=Math.min(Math.max((t-this._min)/(this._max-this._min),0),.999),n=4*Math.floor(256*i);return[this._palette[n],this._palette[n+1],this._palette[n+2]]},_getActualWeight:function(t){t=t||this;var i=t._zoomWeight||t.zoomWeight;if(i&&i.length){var n,e=i.length,o=this._map.getZoom();for(n=0;e>n;n++)if(o>=i[n].zoom)return i[n].weight;return i[n-1].weight}return t._weight||t.weight},_drawOutlines:function(t,i){if(this._outlines){var n,e;for(n=0,e=this._outlines.length;e>n;n++)this._drawOutline(t,i,this._outlines[n].color,this._getActualWeight(this._outlines[n]))}},_drawOutline:function(t,i,n,e){var o,r,s,h,a,l,d,u=this._getActualWeight();if(i||e)for(o=0,s=this._data.length;s>o;o++)if(h=this._data[o],a=u+2*e,h._prevWidth=t.lineWidth=i?(h._prevWidth||a)+1:a,l=h.length){for(t.strokeStyle=n,t.beginPath(),t.moveTo(h[0].x,h[0].y),r=1,l=h.length;l>r;r++)d=h[r],t.lineTo(d.x,d.y);t.stroke()}},_drawHotline:function(t){var i,n,e,o,r,s,h,a,l,d,u=[];for(t.lineWidth=this._getActualWeight(),i=0,e=this._data.length;e>i;i++)for(o=this._data[i],n=1,r=o.length;r>n;n++)if(s=o[n-1],h=o[n],u.push(s),s.z!==h.z||n===r-1){var p=u[0];for(t.beginPath(),t.strokeStyle="rgb("+p.rgb.join(",")+")",t.moveTo(p.x,p.y),d=1,l=u.length;l>d;d++)t.lineTo(u[d].x,u[d].y);t.stroke(),u=[],a=t.createLinearGradient(s.x,s.y,h.x,h.y),a.addColorStop(0,"rgb("+s.rgb.join(",")+")"),a.addColorStop(1,"rgb("+h.rgb.join(",")+")"),t.strokeStyle=a,t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(h.x,h.y),t.stroke()}}},t.HotlineRenderer=t.Canvas.extend({_initContainer:function(){t.Canvas.prototype._initContainer.call(this),this._hotline=new i(this._container,this._map)},_update:function(){t.Canvas.prototype._update.call(this),this._hotline.width(this._container.width),this._hotline.height(this._container.height)},_updatePoly:function(t){this._redrawBounds=null;var i=t._parts,n=i.length;n&&(this._drawnLayers[t._leaflet_id]=t,this._updateOptions(t),this._hotline.data(i).draw(this._clear))},_updateOptions:function(t){t.options.hasOwnProperty("color")&&this._hotline.color(t.options.color),null!=t.options.min&&this._hotline.min(t.options.min),null!=t.options.max&&this._hotline.max(t.options.max),null!=t.options.weight&&this._hotline.weight(t.options.weight),null!=t.options.zoomWeight&&this._hotline.zoomWeight(t.options.zoomWeight),null!=t.options.outlines&&this._hotline.outlines(t.options.outlines),t.options.palette&&this._hotline.palette(t.options.palette),t.options.unknownColor&&this._hotline.unknownColor(t.options.unknownColor),t.options.maxGradient&&this._hotline.maxGradient(t.options.maxGradient),t.options.minGradient&&this._hotline.minGradient(t.options.minGradient),t.options.minColorLength&&this._hotline.minColorLength(t.options.minColorLength),t.options.gradientPercent&&this._hotline.gradientPercent(t.options.gradientPercent)}}),t.hotlineRenderer=function(i){return new t.HotlineRenderer(i)};var n=function(i){return t.Browser.canvas?t.hotlineRenderer(i):null};return t.Hotline=t.Polyline.extend({statics:{Renderer:t.hotlineRenderer,renderer:n},options:{renderer:n(),min:0,max:1,palette:{0:"green",.5:"yellow",1:"red"},unknownColor:"#aaa",weight:6,zoomWeight:[{zoom:13,weight:5},{zoom:11,weight:4}],outlines:[{color:"#aaa",weight:4,zoomWeight:[{zoom:13,weight:4},{zoom:11,weight:3}]},{color:"white",weight:3,zoomWeight:[{zoom:13,weight:3},{zoom:11,weight:2}]}],maxGradient:30,minGradient:10,minColorLength:10,gradientPercent:30},getRGBForValue:function(t){return this._renderer._hotline.getRGBForValue(t)},_projectLatlngs:function(i,n,e){var o,r,s=i[0]instanceof t.LatLng,h=i.length;if(s){for(r=[],o=0;h>o;o++)r[o]=this._map.latLngToLayerPoint(i[o]),r[o].z=i[o].alt,e&&e.extend(r[o]);n.push(r)}else for(o=0;h>o;o++)this._projectLatlngs(i[o],n,e)},_simplifyPoints:function(){for(var i=this._parts,n=this.options.smoothFactor,e=0,o=i.length;o>e;e++){for(var r=i[e],s=0,h=r.length;h>s;s++)r[s].cantBeDeleted=!r[s-1]||r[s-1].z!==r[s].z||!r[s+1]||r[s+1].z!==r[s].z;i[e]=t.HotlineUtil.simplify(i[e],n)}},_clipPoints:function(){var i=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(i)){if(this.options.noClip)return void(this._parts=this._rings);var n,e,o,r,s,h,a,l=this._parts;for(n=0,o=0,r=this._rings.length;r>n;n++)for(a=this._rings[n],e=0,s=a.length;s-1>e;e++)h=t.HotlineUtil.clipSegment(a[e],a[e+1],i,e,!0),h&&(l[o]=l[o]||[],l[o].push(h[0]),(h[1]!==a[e+1]||e===s-2)&&(l[o].push(h[1]),o++))}},setOpacity:function(t){this._renderer&&this._renderer._hotline&&this._renderer._hotline._canvas&&(this._renderer._hotline._canvas.style.opacity=t)},_clickTolerance:function(){var i,n,e=[];for(i=0,n=this.options.outlines.length;n>i;i++)e.push(this.options.outlines[i].weight);return this.options.weight/2+Math.max.apply(this,e)+(t.Browser.touch?10:0)}}),t.hotline=function(i,n){return new t.Hotline(i,n)},t});
